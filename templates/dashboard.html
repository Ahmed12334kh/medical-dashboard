<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">

<!-- ðŸ”¥ REQUIRED FOR RESPONSIVENESS -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Real-Time Patient Dashboard</title>

<style>
:root{
  --blue:#2f6df6;
  --orange:#f59e0b;
  --red:#ef4444;
}

body{
  font-family: "Segoe UI", Roboto, Arial;
  background:#f5f8fc;
  margin:0;
  text-align:center;
}

h1{
  color:#2563eb;
  margin-top:30px;
}

.subtitle{
  color:#64748b;
  font-size:14px;
}

.dashboard{
  display:flex;
  justify-content:center;
  flex-wrap:wrap;
  gap:40px;
  margin:60px auto 0;
  max-width:1100px;
  padding:0 16px;
}

.card{
  width:180px;
  text-align:center;
  transition:transform .3s;
}

.card:hover{
  transform:translateY(-6px);
}

.circle{
  width:160px;
  height:160px;
  border-radius:50%;
  margin:auto;
  color:white;
  display:flex;
  flex-direction:column;
  justify-content:center;
  box-shadow:0 15px 40px rgba(0,0,0,.15);
  transition:background .5s, box-shadow .5s;
}

.circle.pulse{
  animation:pulse 1.2s ease-out;
}

@keyframes pulse{
  0%{box-shadow:0 0 0 0 rgba(47,109,246,.6)}
  100%{box-shadow:0 0 0 25px rgba(47,109,246,0)}
}

.label{
  font-size:13px;
  opacity:.9;
}

.value{
  font-size:26px;
  font-weight:600;
  margin-top:5px;
}

.status{
  font-size:11px;
  margin-top:6px;
  opacity:.9;
}

/* ðŸ”¥ SVG RESPONSIVE FIX (NO VISUAL CHANGE) */
.sparkline{
  width:160px;
  height:40px;
  margin:12px auto 0;
}

.sparkline svg{
  width:100%;
  height:100%;
}

.footer{
  margin-top:60px;
  font-size:12px;
  color:#94a3b8;
}

/* ========================= */
/* RESPONSIVE â€” SAME UI */
/* ========================= */

@media (max-width: 900px) {
  .dashboard{
    gap:30px;
  }
  .card{
    width:160px;
  }
  .circle{
    width:140px;
    height:140px;
  }
  .value{
    font-size:22px;
  }
}

@media (max-width: 600px) {
  h1{
    font-size:22px;
  }
  .dashboard{
    gap:25px;
    margin-top:40px;
  }
  .card{
    width:140px;
  }
  .circle{
    width:120px;
    height:120px;
  }
  .value{
    font-size:20px;
  }
  .sparkline{
    width:120px;
  }
}
</style>
</head>

<body>

<h1>ðŸ©º Real-Time Patient Dashboard</h1>
<div class="subtitle">Live vitals streamed from sensor â†’ cloud â†’ web</div>
<div class="subtitle" id="updated">Last updated: --</div>

<div class="dashboard">

  <div class="card">
    <div class="circle" id="hrCircle">
      <div class="label">Heart Rate</div>
      <div class="value" id="hrVal">--</div>
      <div class="status" id="hrStatus"></div>
    </div>
    <div class="sparkline">
      <svg viewBox="0 0 160 40">
        <polyline id="hrLine" fill="none" stroke="#2f6df6" stroke-width="2"/>
      </svg>
    </div>
  </div>

  <div class="card">
    <div class="circle" id="prCircle">
      <div class="label">Pulse Rate</div>
      <div class="value" id="prVal">--</div>
      <div class="status" id="prStatus"></div>
    </div>
    <div class="sparkline">
      <svg viewBox="0 0 160 40">
        <polyline id="prLine" fill="none" stroke="#2f6df6" stroke-width="2"/>
      </svg>
    </div>
  </div>

  <div class="card">
    <div class="circle" id="bpCircle">
      <div class="label">Blood Pressure</div>
      <div class="value" id="bpVal">--</div>
      <div class="status" id="bpStatus"></div>
    </div>
    <div class="sparkline">
      <svg viewBox="0 0 160 40">
        <polyline id="bpLine" fill="none" stroke="#2f6df6" stroke-width="2"/>
      </svg>
    </div>
  </div>

  <div class="card">
    <div class="circle" id="tempCircle">
      <div class="label">Temperature</div>
      <div class="value" id="tempVal">--</div>
      <div class="status" id="tempStatus"></div>
    </div>
    <div class="sparkline">
      <svg viewBox="0 0 160 40">
        <polyline id="tempLine" fill="none" stroke="#2f6df6" stroke-width="2"/>
      </svg>
    </div>
  </div>

</div>

<div class="footer">
  Medical IoT Dashboard â€¢ Flask API â€¢ Real-Time Monitoring
</div>

<script>
const historySize = 20;
const dataHistory = {hr:[], pr:[], bp:[], temp:[]};

function statusColor(value, min, max){
  if(value < min || value > max) return ["var(--red)","Critical"];
  if(value < min+10 || value > max-10) return ["var(--orange)","Warning"];
  return ["var(--blue)","Normal"];
}

function updateSparkline(id, arr){
  if(arr.length < 2) return;
  const max = Math.max(...arr);
  const min = Math.min(...arr);
  const points = arr.map((v,i)=>{
    const x = (i/(historySize-1))*160;
    const y = 40 - ((v-min)/(max-min+1))*35;
    return `${x},${y}`;
  }).join(" ");
  document.getElementById(id).setAttribute("points",points);
}

async function update(){
  const r = await fetch("/api/vitals");
  const d = await r.json();
  if(!d.heart_rate) return;

  document.getElementById("updated").innerText =
    "Last updated: "+new Date().toLocaleTimeString();

  const metrics = [
    ["hr", d.heart_rate, 60, 100],
    ["pr", d.pulse_rate, 60, 100],
    ["bp", parseInt(d.blood_pressure.split("/")[0]), 90, 140],
    ["temp", d.body_temperature, 36, 38]
  ];

  metrics.forEach(([k,v,min,max])=>{
    dataHistory[k].push(v);
    if(dataHistory[k].length>historySize) dataHistory[k].shift();

    const [color,status] = statusColor(v,min,max);
    const c = document.getElementById(k+"Circle");
    c.style.background = color;
    c.classList.remove("pulse"); void c.offsetWidth; c.classList.add("pulse");

    document.getElementById(k+"Val").innerText =
      k==="bp" ? d.blood_pressure : v + (k==="temp"?" Â°C":" bpm");
    document.getElementById(k+"Status").innerText = status;

    updateSparkline(k+"Line", dataHistory[k]);
  });
}

setInterval(update,2000);
</script>

</body>
</html>

